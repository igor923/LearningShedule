<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>auth</title>
    <script src="imports/jquery-3.1.1.min.js"></script>
    <script src="imports/jquery-ui.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.14.0.css">
    <script src="imports/jquery.cookie.js"></script>

    <script src="imports/core.js"></script>
    <script src="imports/md5.js"></script>
    <link rel="stylesheet" href="styleAuth.css"/>
</head>
<body>
<div id="container">
    <div id="header">

        <img id="logoBig" class="centered" src="img/Logobig.png"/>
        <img id="logo" class="centered" src="img/Logo.png"/>

        <div class=" centered telran">
            <h1>TEL-RAN</h1>
            <h6>COMPUTING SOLUTION LTD.</h6>
            <h3>ATTENDANCE AND SHEDULE</h3></div>
    </div>

    <div id="content" class="centered">
            <form action=none method="POST" >
            <input id="user" class="input" type="text" name="login" placeholder="login"><br>
            <input id="pass" class="input" type="password" name="password" placeholder="password"><br>
            <input id="submit" class="but" type="submit" name="submit" value="SUBMIT">
        </form>
        <h6>Just input your login and password<br>
            and youâ€™ll be transferred to personal page</h6>
    </div>
</div>

<script src="admin.js"></script>
<script>
    //    console.log("prev coookie ",);

    $(function () {
           if ($.cookie("token"))  $.post('/check/token',$.cookie("token"), function (data) {
               var response = JSON.parse(data);
           if(response.result === 'ok'){
                    routing(response);
           }
       } );

        $('#submit').click(function () {

            var passMD5 = CryptoJS.MD5($('#pass').val()).toString();
            var user = $('#user').val();
            var url = '/auth/user';
            var postBody = {
                pass: passMD5,
                name: user
            };
            var strPostBody = JSON.stringify(postBody);
            requestToServerPost(url, strPostBody);
        });

        var requestToServerPost = function (url, postBody) {
            $.post(url, postBody, function (data) {
                $('input').removeClass('red');
                console.log('data:' + data);    //>>> here response from server - 'data'
                var result = JSON.parse(data);
                if (result.status != 'ok') {
                    console.log($(result.field));
                    $(result.field).addClass("red");
                }
                if (result.token) {
                     routing(result);
                    $.cookie("token", result.token);

                }
            });
        };

        var routing = function (data) {
            data.role = 'admin';
            if(data.role === 'student') studentPage(data);       // Igor
            else if(data.role === 'teacher') teacherPage(data);  // Kirill
            else if(data.role === 'admin') adminPage(data);      // none
        }

    });
</script>

</body>
</html>